{"version":3,"sources":["../../../../assets/Script/assets/Script/Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["import ResourceManager from \"./managers/ResourceManager\";\nimport SceneManager from \"./SceneManager\";\nimport User from \"./users/User\";\n\nconst {ccclass, property} = cc._decorator;\nenum Direction {\n    LEFT,\n    UP,\n    RIGHT,\n    DOWN,\n    NONE\n}\nenum GameState {\n    INIT,\n    BEGIN,\n    END\n}\n@ccclass\nexport default class Game extends cc.Component {\n\n    // LIFE-CYCLE CALLBACKS:\n    @property({type: cc.Node})\n    board: cc.Node = null;\n    @property({type: cc.Node})\n    ball: cc.Node = null;\n    @property({type: cc.Node})\n    ballp: cc.Node = null;\n    @property({type: cc.Prefab})\n    hole: cc.Prefab = null;\n    @property({type: cc.AudioClip})\n    ballFallAudio: cc.AudioClip = null;\n    @property(cc.Node)\n    bg: cc.Node = null;\n    @property(cc.Label)\n    levelLabel: cc.Label = null;\n    @property(cc.Camera)\n    mainCamera: cc.Camera = null;\n    @property(cc.Prefab)\n    holeWin: cc.Prefab = null;\n    @property(cc.Prefab)\n    holeLose: cc.Prefab = null;\n    @property(cc.Node)\n    holeCon: cc.Node = null;\n    @property(cc.Node)\n    overMenu: cc.Node = null;\n\n    private speed: number = 1;\n    \n    private canMove: boolean = true;\n\n    private dir: Direction = Direction.NONE;\n    private over: boolean = false;\n    private curState: GameState = GameState.INIT;\n    // 小球是否下落完毕\n    private ballIsDown: boolean = false;\n    private levelData: any = null;\n\n    private startTime: boolean = false;\n    private timeUsed: number = 0;\n    \n\n    private gridMap: cc.Vec2[][];\n    private readonly gridWidth: number = 70;\n    private readonly gridHeight: number = 70;\n\n    private loseHolePool: cc.NodePool = null;\n    private poolDeep: number = 40;\n\n    private holeWinNode: cc.Node = null;\n\n    async onLoad () {\n        // this.overMenu.active = false;\n        this.gridMap = [];\n        cc.macro.ENABLE_WEBGL_ANTIALIAS = true;\n        cc.director.getPhysicsManager().enabled = true;\n        let self = this;\n        console.log(\"bg is \",this.bg);\n        let sceneManager: SceneManager = <SceneManager>cc.find(\"Controller\").getComponent(\"SceneManager\");\n        let levelStr: string = sceneManager.getLevel().toString();\n        // 加载关卡数据\n        let levelData: cc.JsonAsset = await ResourceManager.getInstance().loadResourceByUrl(`level${levelStr}`,cc.JsonAsset);\n        this.levelData = levelData.json;\n        console.log(\"levelData is \",this.levelData);\n        cc.director.on(\"ballToHole\",this.overHandle,this);\n        cc.director.on(\"ballToBoard\",this.ballToBoardHandle,this);\n        cc.director.on(\"ballToLand\",this.ballToLandHandle,this);\n\n        // 初始化相关代码\n        this.initHoleGrid();\n        this.initHolePoolForLose();\n        this.initHole();\n        console.log(\"gridMap is \",this.gridMap);\n\n        // cc.tween(this.holeWinNode).to({\n        //     y: self.holeWinNode.height\n        // })\n    }\n    // 初始化洞穴网格\n    private initHoleGrid(): void {\n        if(this.levelData) {\n            // 列\n            let col: number = this.levelData.col;\n            // 行\n            let row: number = this.levelData.row;\n            for(let i = 0; i < row; i++) {\n                this.gridMap[i] = [];\n                for(let j = 0; j < col; j++) {\n                    let pos: cc.Vec2 = new cc.Vec2();\n                    pos.x = this.gridWidth / 2 + j * this.gridWidth;\n                    pos.y = this.gridHeight / 2 + i * this.gridHeight;\n                    this.gridMap[i].push(pos);\n                    // this.gridMap[i][j] = pos;\n                }\n            }\n        }\n    }\n    // 初始化失败洞穴节点池\n    private initHolePoolForLose(): void {\n        this.loseHolePool = new cc.NodePool();\n        for(let i = 0; i < this.poolDeep; i++) {\n            let loseNode: cc.Node = cc.instantiate(this.holeLose);\n            this.loseHolePool.put(loseNode);\n            // this.holeCon.addChild(loseNode);\n        }\n    }\n    // 初始化终点洞穴,障碍洞穴\n    private initHole(): void {\n        if(this.levelData) {\n            let objects: any[] = this.levelData.objects;\n            for(let i = 0; i < objects.length; i++) {\n                if(i === 0) {\n                    // 初始化终点洞穴\n                    let posObj: any = objects[i].pos;\n                    this.holeWinNode = cc.instantiate(this.holeWin);\n                    this.holeCon.addChild(this.holeWinNode);\n                    this.holeWinNode.setPosition(this.gridMap[posObj.row][posObj.col]);\n                    this.holeWinNode.scale = Number(objects[i].scaleMultiplier);\n                } else {\n                    let posObj: any = objects[i].pos;\n                    let loseHoleNode: cc.Node = this.loseHolePool.get();\n                    console.log(\"从节点池中获取的节点是：\",loseHoleNode);\n                    if(loseHoleNode) {\n                        loseHoleNode.setPosition(this.gridMap[posObj.row][posObj.col]);\n                        this.holeCon.addChild(loseHoleNode);\n                    }\n                }\n            }\n        }\n        // this.ball.zIndex = this.ball.parent\n    }\n    // 球碰到地板了说明是掉下去了游戏结束\n    private ballToLandHandle(): void {\n        this.startTime = false;\n        this.overMenu.getChildByName(\"tryLabel\").getComponent(cc.Label).string = \"TRY AGAIN\";\n        let inName: string = this.overMenu.getComponent(cc.Animation).getClips()[0].name;\n        this.overMenu.getComponent(cc.Animation).play(inName);\n        this.over = true;\n    }\n    // 游戏结束\n    private async overHandle(data: any) {\n        this.startTime = false;\n        if(data.over === \"win\") {\n            // 胜利\n            console.log(\"游戏胜利\");\n            await this.ballToHoleHandle(this.holeWinNode);\n            this.overMenu.getChildByName(\"tryLabel\").getComponent(cc.Label).string = \"SUCCESS\";\n            this.overMenu.getChildByName(\"successCon\").active = true;\n            let successLabel: cc.Label = <cc.Label>this.overMenu.getChildByName(\"successCon\").getChildByName(\"time\").getComponent(cc.Label);\n            let bestTimeString: string  = this.updateTimeByTotalTime(this.timeUsed,successLabel);\n\n            let inName: string = this.overMenu.getComponent(cc.Animation).getClips()[0].name;\n            this.overMenu.getComponent(cc.Animation).play(inName);\n            // 记录该用户最好成绩\n            let userCom: User = <User>cc.find(\"Controller\").getComponent(\"User\");\n            userCom.setBestRecord(Number(cc.find(\"Controller\").getComponent(\"SceneManager\").getLevel().toString()),bestTimeString);\n            \n        } else if(data.over === \"lose\") {\n            await this.ballToHoleHandle(data.node);\n            console.log(\"游戏失败\");\n            // this.overMenu.active = true;\n            this.overMenu.getChildByName(\"tryLabel\").getComponent(cc.Label).string = \"TRY AGAIN\";\n            let inName: string = this.overMenu.getComponent(cc.Animation).getClips()[0].name;\n            this.overMenu.getComponent(cc.Animation).play(inName);\n        }\n        \n    }\n    private ballToBoardHandle(): void {\n        let self = this;\n        if(!self.ballIsDown) {\n            self.ballIsDown = true;\n            self.levelLabel.string = \"00:00\";\n            cc.tween(this.ballp).to(0.5,{\n                opacity: 0\n            }).start();\n            let scaleAnim: cc.AnimationClip = self.levelLabel.node.getComponent(cc.Animation).getClips()[1];\n            self.levelLabel.node.getComponent(cc.Animation).play(scaleAnim.name);\n            cc.audioEngine.play(self.ballFallAudio,false,0.5);\n        }\n    }\n    private set CurState(state: GameState) {\n        switch(state) {\n            case GameState.INIT:\n                this.curState = GameState.INIT;\n                break;\n            case GameState.BEGIN:\n                this.curState = GameState.BEGIN;\n                break;\n            case GameState.END:\n                this.curState = GameState.END;\n                this.gameOver();\n                break;\n        }\n    }\n    private gameOver(): void {\n        this.canMove = false;\n        this.over = true;\n        this.Dir = Direction.NONE;\n        this.startTime = false;\n    }\n    // start 函数\n    start () {\n        // cc.audioEngine.playMusic(this.bgm,true);\n        let self = this;\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this);\n\n    }\n    private async ballToHoleHandle(targetNode: cc.Node): Promise<any> {\n        let self = this;\n        if(!self.over) {\n            // 关闭物理系统\n            cc.director.getPhysicsManager().enabled = false;\n            self.CurState = GameState.END;\n            self.canMove = false;\n            self.over = true;\n            self.Dir = Direction.NONE;\n            let worldPosition: cc.Vec2 = self.holeCon.convertToWorldSpace(cc.v2(targetNode.x,targetNode.y));\n            let localPosition: cc.Vec2 = self.node.convertToNodeSpaceAR(worldPosition);\n            return new Promise((resolve,reject) => {\n                cc.tween(self.ball).to(0.3,{\n                    x: localPosition.x,\n                    y: localPosition.y\n                }).call(() => {\n                    console.log(\"游戏结束\");\n                    cc.tween(self.ball).to(0.2,{\n                        scale: 0\n                    }).call(() => {\n                        resolve();\n                    }).start();\n                }).start();\n                self.board.getComponent(cc.Animation).play(\"boardW\");\n                if(targetNode.group === \"holewin\") {\n                    let winAnimName: string = self.holeWinNode.getComponent(cc.Animation).getClips()[2].name;\n                    self.holeWinNode.getComponent(cc.Animation).play(winAnimName);\n                }\n            });\n            // cc.director.emit(\"over\");\n        }\n    }\n    set Dir(dir: Direction) {\n        switch(dir) {\n            case Direction.LEFT:\n                this.dir = Direction.LEFT;\n                break;\n            case Direction.RIGHT:\n                this.dir = Direction.RIGHT;\n                break;\n            case Direction.UP:\n                this.dir = Direction.UP;\n                break;\n            case Direction.DOWN:\n                this.dir = Direction.DOWN;\n                break;\n            case Direction.NONE:\n                this.dir = Direction.NONE;\n                break;    \n        }\n    }\n    private onKeyDown(e: cc.Event.EventKeyboard): void {\n        console.log(e.keyCode);\n        if(this.canMove) {\n            this.startTime = true;\n            switch(e.keyCode) {\n                case 37:\n                    this.Dir = Direction.LEFT;\n                    cc.director.emit(\"none\");\n                    break;\n                case 38:\n                    this.Dir = Direction.UP;\n                    cc.director.emit(\"up\");\n                    break;\n                case 39:\n                    this.Dir = Direction.RIGHT;\n                    cc.director.emit(\"none\");\n                    // this.board.angle -= \n                    break;\n                case 40:\n                    cc.director.emit(\"down\");\n                    this.Dir = Direction.DOWN;\n                    break;            \n            }\n        }\n    }\n    private onKeyUp(e: cc.Event.EventKeyboard): void {\n        this.Dir = Direction.NONE;\n        cc.director.emit(\"none\");\n    }\n    onDestroy(): void {\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this);\n        cc.director.off(\"ballToHole\",this.ballToHoleHandle,this);\n        cc.director.off(\"ballToBoard\",this.ballToBoardHandle,this);\n        \n    }\n    private updateLevelOrTime(dt: number): void {\n        let self = this;\n        if(self.startTime) {\n            self.timeUsed += dt;\n            // self.timeUsed = Math.floor(self.timeUsed);\n            this.updateTimeByTotalTime(self.timeUsed,self.levelLabel);\n        }\n    }\n    private updateTimeByTotalTime(totalTime: number,targetLabel: cc.Label): string {\n        let self = this;\n        let resString: string = \"\";\n        let minutes: number = Math.floor(totalTime / 60);\n        let seconds: number = Math.floor(totalTime % 60);\n        if(minutes < 10) {\n            if(seconds < 10) {\n                targetLabel.string = `0${minutes}:0${seconds}`;\n            } else {\n                targetLabel.string = `0${minutes}:${seconds}`;\n            }\n        } else {\n            if(seconds < 10) {\n                targetLabel.string = `${minutes}:0${seconds}`;\n            } else {\n                targetLabel.string = `${minutes}:${seconds}`;\n            }\n        }\n        resString = targetLabel.string;\n        return resString;\n    }\n    update (dt) {\n        let self = this;\n        this.updateLevelOrTime(dt);\n        switch(this.dir) {\n            case Direction.LEFT:\n                if(this.board.angle <= 20) {\n                    this.board.angle += this.speed;\n                }\n                break;\n            case Direction.RIGHT:\n                if(this.board.angle >= -20) {\n                    this.board.angle -= this.speed;\n                }\n                break;\n            case Direction.UP:\n                this.board.y += dt * 200;\n                this.mainCamera.node.y += dt * 200;\n                break;\n            case Direction.DOWN:\n                this.board.y -= dt * 200;\n                this.mainCamera.node.y -= dt * 200;\n                break;\n        }\n    }\n}\n"]}